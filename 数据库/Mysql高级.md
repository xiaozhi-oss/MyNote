# 数据库的设计

## 一、数据库的设计

### 1.多表之间的关系

​	①一对一（了解）
​		例如：人和身份证，每个人的身份证都是唯一的	
​	②一对多（多对一）
​		例如：部门和部员，一个部门可以有多个部员，一个部员只能有一个部门
​	③多对多
​		例如：学生和课程，学生可以选择多门课程，课程也可以被多个学生选



### 2.实现关系

​	①一对多
​		通过外键的方式来实现
​	②多对多
​		需要一张中间表来将另外的两张表联合，也是通过外键的方式实现
​	③一对一
​		可以通过外键的方式来关联另外一张表
​		不过一般都是合成一张表来实现的
复合主键：primary key(列名1,列名2,...,列名n)
​		两个外键是不能重复的
联合主键：多个主键联合形成一个主键的组合。

用法：当一bai个字段无法确定唯一性的时du候，需zhi要其他字段来dao一起形成唯一性。
就内是说用来组成唯一性容的字段如果有多个就是联合主键



## 二、范式

**概念**：设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小。目前关系数据库六种范式：第一范式（1NF）、第二范式（2NF）、第范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。

①第一范式(1NF)：每一列的都是不可割分的原子数据项
②第二范式(2NF)：在1NF的基础上，非码属性必须完全依赖于码（在1NF基础上消除非主属性对主码的																					部分函数依赖）
属性组：两列或两列以上可以确定唯一的值
	 几个概念： 里面用到的例子要结合学生表信息看
		1.函数依赖：A-->B,如果通过A属性(属性组)的值，
					 可以确定唯一B属性的值。则称B依赖于A
					 例如：学号 --> 姓名。  （学号，课程名称） --> 分数
		2.完全依赖：A-->B， 如果A是一个属性组，
					 则B属性值得确定需要依赖于A属性组中所有的属性值。
					 例如：（学号，课程名称） --> 分数
		3.部分依赖：A-->B， 如果A是一个属性组，
					 则B属性值得确定只需要依赖于A属性组中某一些值即可。
					 例如：（学号，课程名称） -- > 姓名
		4.传递依赖：A-->B, B -- >C . 如果通过A属性(属性组)的值，
			        可以确定唯一B属性的值，在通过B属性（属性组）的值可以确定唯一C属性的值，
					 则称 C 传递函数依赖于A
					 例如：学号-->系名，系名-->系主任
		5.码：如果在一张表中，一个属性或属性组，被其他所有属性所完全依赖，
				则称这个属性(属性组)为该表的码
				例如：该表中码为：（学号，课程名称）
			主属性：码属性组中的所有属性
			非主属性：除过码属性组的属性

③第三范式(3NF)：在2NF的基础上，
					任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）



## 三、数据库的备份和还原

1.命令行的方式：
	备份语法：mysqldump -u用户名 -p密码 数据库的名称 > 保存的路径
	还原语法：①登录db	②创建db	③使用db	④source文件路径
2.图形化工具：



总结：
①在创建数据库的时候要构思好数据库的内容
②数据不能有冗余，降低速度
③每一列都是单独的数据
④不能删除了一行数据就把其他相关的东西删除了
	比如：将部门和个人信息放在同一张表，人辞职了，个人信息删了，部门的信息也跟着删了





# 事物

## 一、基本介绍

### 1.概念

在进行多个操作的时候，如果遇到错误就会使程序停止，当你开启事物的时候，要么同时成功，要么同时失败，保证了程序运行的完整性

例子：张三给李四转钱，张三钱转出去了，但是发生了错误，李四没有收到钱，这就是一个错误



### 2.操作

​	①开启事物： start transaction;
​	②回滚事物： rollback;
​		回到最初的起点。
​	③提交事物： commit;
​	④MySQL数据库中事物默认是自动提交
​	   oracle数据库默认是手动提交

**注意**：如果开启了事物，而你又没有提交事物，那么数据是没有被持久化改变的，相当于是将修改的数据放在缓冲区，你要提交它才会持久化改变

**修改事物的默认提交方式**：
**查询**：`select @@autocommit;`
			1表示自动	0表示主动
**修改****：`set @auttocommit 1或0;`

==记住：手动提交的时候一定要commit一下==



## 二、事物的四大特征ACID

1.原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败。
2.持久性：当事物提交或回滚之火会持久化数据
3.隔离性：多个事物之间相互独立
4.一致性：事物操作前后数据总量不变
	例子：转账 --> 转账前后的钱的总量是不变的



## 三、事物的隔离级别（了解）

### 概念

多个事物之间隔离的，相互独立的，如果多个事物操作同一数据，则会引发一些问题，通过设置隔离级别解决问题



### 存在的问题

​	1.脏读：一个事物读取到另外一个事物中没有提交的数据
​	2.不可重复读（虚读）：同一个事中两次读到的数据不一样
​	3.幻读：一个事物操作(DML)数据中的所有记录，另外一个事物添加一条数据，则另外一个事物查询不到自己的修改。



### 隔离级别：

​	①read uncommitted：读未提交
​		产生的问题：脏读、不可重复读、幻读
​	②read committed：读已提交			--	 orcale默认
​		产生的问题：不可重复读，幻读
​	③repeatable read：可重复读			--   MySQL默认
​		产生的问题：幻读
​	④serializable：串行化	
​		解决所有问题

**注意**：①隔离级别从大到小安全性越来越高，但是效率也是越来越低
		   ②记住是多个事物操作同一数据的时候



### 查看和设置隔离级别

1.设置当前会话隔离级别
	`set session transaction isolatin level 级别字符串;`
2.查看当前会话隔离级别
	`select @@tx_isolation;`

3.设置系统当前隔离级别
	`set global transaction isolation level 级别字符串;`
4.查看系统当前隔离级别
	`select @@global.tx_isolation;`



**代码实现**

```sql
set global transaction isolation level read uncommitted;	-- 设置隔离级别
start transaction;	-- 开启事物
-- 转账操作
update account set balance = balance - 500 where id = 1;	
update account set balance = balance + 500 where id = 2;
```



