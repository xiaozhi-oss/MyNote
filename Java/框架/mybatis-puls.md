# Mybaits-plus

## æ˜¯ä»€ä¹ˆâ“

**MyBatis-Plus**ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª **MyBatis**çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚

![X0__PD8A__MZOMQ`@H1WR_D.png](https://i.loli.net/2021/04/28/GD4cQkNXirICVeS.png)

**ç‰¹æ€§**

-   **æ— ä¾µå…¥**ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘
-   **æŸè€—å°**ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ
-   **å¼ºå¤§çš„ CRUD æ“ä½œ**ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚
-   **æ”¯æŒ Lambda å½¢å¼è°ƒç”¨**ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™
-   **æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ**ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜
-   **æ”¯æŒ ActiveRecord æ¨¡å¼**ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ
-   **æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ**ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰
-   **å†…ç½®ä»£ç ç”Ÿæˆå™¨**ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨
-   **å†…ç½®åˆ†é¡µæ’ä»¶**ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢
-   **åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“**ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“
-   **å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶**ï¼šå¯è¾“å‡º Sql è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢
-   **å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶**ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ



ğŸ‘€å®˜ç½‘ï¼šhttps://mp.baomidou.com/

ğŸ‘å®˜æ–¹æ–‡æ¡£ï¼šhttps://mp.baomidou.com/guide/

æˆ‘ä»¬æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ¥è¿›è¡Œå­¦ä¹ 



## å…¥é—¨

### 1	 å¼•å…¥ä¾èµ–

```xml
<!--mybaits-plus-->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.4.2</version>
</dependency>
<!--mysqlä¾èµ–-->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
<!--lombok-->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>
```

### 2	åˆ›å»ºè¡¨å’Œæ·»åŠ æ•°æ®

```sql
CREATE DATABASE IF NOT EXISTS mybatis_plus;
CREATE TABLE USER
(
    id BIGINT(20)NOT NULL COMMENT 'ä¸»é”®ID',
    NAME VARCHAR(30)NULL DEFAULT NULL COMMENT 'å§“å',
    age INT(11)NULL DEFAULT NULL COMMENT 'å¹´é¾„',
    email VARCHAR(50)NULL DEFAULT NULL COMMENT 'é‚®ç®±',
    PRIMARY KEY (id)
);
INSERT INTO USER (id, NAME, age, email)VALUES
(1, 'Jone', 18, 'test1@baomidou.com'),
(2, 'Jack', 20, 'test2@baomidou.com'),
(3, 'Tom', 28, 'test3@baomidou.com'),
(4, 'Sandy', 21, 'test4@baomidou.com'),
(5, 'Billie', 24, 'test5@baomidou.com');
```

### 3	åˆ›å»ºå®ä½“ç±»

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class User {

    private Long id;
    private String username;
    private String password;
    private String email;
}
```

### 4	åˆ›å»ºmapperç±»

```java
@Repository
public interface UserMapper extends BaseMapper<User> {
    
}
```

åœ¨ä¸»å¯åŠ¨ç±»ä¸­å¼€å¯mapperæ‰«æ

![AP__QI485AJNVXGS75S6WU7.png](https://i.loli.net/2021/04/28/wKABkJdQUgFS8se.png)

### 5	æµ‹è¯•

```java
@SpringBootTest
class MybatisPlusApplicationTests {

    @Autowired
    UserMapper userMapper;
    @Test
    void findAll() {
        List<User> users = userMapper.selectList(null);
        for (User user : users) {
            System.out.println(user);
        }
    }

}
```

```properties
# mybatisæ—¥å¿—
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
```

![CL~D43Z7A3FPOYKMNGW7HF0.png](https://i.loli.net/2021/04/28/ZIm5fXJAls7LpqR.png)





## ä¸»é”®ç­–ç•¥

mpçš„é»˜è®¤ä¸»é”®ç­–ç•¥æ˜¯ASSIGN_ID ï¼ˆä½¿ç”¨äº†é›ªèŠ±ç®—æ³•ï¼‰



### æ’å…¥ä¸€æ¡è®°å½•

**æµ‹è¯•**ï¼šæˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•

```java
@Test
public void insertTest(){
    User user = new User();
    user.setName("å°æ™º");
    user.setAge(18);
    user.setEmail("123@qq.com");
    userMapper.insert(user);
    System.out.println(user);
}
```

**æŸ¥çœ‹ç»“æœ**

![image-20210428214102978](https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20210428214102978.png)





### é›ªèŠ±ç®—æ³•

åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œé›ªèŠ±ç®—æ³•æ˜¯ç”±Twitterå…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿä¿è¯**ä¸åŒè¡¨çš„ä¸»é”®çš„ä¸é‡å¤æ€§**ï¼Œä»¥åŠç›¸åŒè¡¨çš„ä¸»é”®çš„æœ‰åºæ€§ã€‚



**æ ¸å¿ƒæ€æƒ³ï¼š**

é•¿åº¦å…±64bitï¼ˆä¸€ä¸ªlongå‹ï¼‰ã€‚

é¦–å…ˆæ˜¯ä¸€ä¸ªç¬¦å·ä½ï¼Œ1bitæ ‡è¯†ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0ã€‚

41bitæ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œå­˜å‚¨çš„æ˜¯æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª)ï¼Œç»“æœçº¦ç­‰äº69.73å¹´ã€‚

10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„æœºå™¨IDï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼‰ã€‚

12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯æ¯«ç§’å¯ä»¥äº§ç”Ÿ 4096 ä¸ª IDï¼‰ã€‚

![IMG_256](F:\Javaå­¦ä¹ \æˆªå›¾\clip_image002.jpg)

**ä¼˜ç‚¹**ï¼šæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ã€‚



### ä¸»é”®è‡ªå¢

åœ¨ä¸»é”®çš„å­—æ®µä¸Šæ·»åŠ æ³¨è§£

```java
@TableId(type = IdType.AUTO)
private Long id;
```

![image-20210428215610052](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210428215610052.png)

è®¾ç½®å®Œæˆä¹‹åè¿›è¡Œæµ‹è¯•

![image-20210428215807166](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210428215807166.png)

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„çš„ä¸»é”®è‡ªåŠ¨é€’å¢äº†



**è®¾ç½®å…¨å±€ä¸»é”®ç”Ÿæˆç­–ç•¥**

```properties
#å…¨å±€è®¾ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥
mybatis-plus.global-config.db-config.id-type=auto
```





## è‡ªåŠ¨å¡«å……

1	æ•°æ®åº“ä¸­æ·»åŠ ä¸¤ä¸ªdatatimeç±»å‹çš„å­—æ®µ

2	å®ä½“ç±»ä¸­æ·»åŠ ä¸¤ä¸ªå˜é‡å¹¶æ·»åŠ æ³¨é‡Š

```java
    @TableField(fill = FieldFill.INSERT)    // åˆ›å»ºæ—¶æ’å…¥æ•°æ®
    private Date createTime;
    @TableField(fill = FieldFill.UPDATE)    // æ›´æ–°æ—¶æ’å…¥æ•°æ®
    private Date updateTime;
```

æºç ä¸­å¾ˆæ¸…æ¥šçš„å†™ç€

![image-20210428221250899](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210428221250899.png)

3	è‡ªå®šä¹‰æ¥å£å®ç°MetaObjectHandler æ¥å£ï¼Œè‡ªå®šä¹‰ç­–ç•¥

å®˜ç½‘ä¸Šçš„ä¾‹å­

```java
@Slf4j
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        log.info("start insert fill ....");
        this.strictInsertFill(metaObject, "createTime", LocalDateTime.class, LocalDateTime.now()); // èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨èä½¿ç”¨)
        // æˆ–è€…
        this.strictUpdateFill(metaObject, "createTime", () -> LocalDateTime.now(), LocalDateTime.class); // èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)
        // æˆ–è€…
        this.fillStrategy(metaObject, "createTime", LocalDateTime.now()); // ä¹Ÿå¯ä»¥ä½¿ç”¨(3.3.0 è¯¥æ–¹æ³•æœ‰bug)
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        log.info("start update fill ....");
        this.strictUpdateFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now()); // èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨è)
        // æˆ–è€…
        this.strictUpdateFill(metaObject, "updateTime", () -> LocalDateTime.now(), LocalDateTime.class); // èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)
        // æˆ–è€…
        this.fillStrategy(metaObject, "updateTime", LocalDateTime.now()); // ä¹Ÿå¯ä»¥ä½¿ç”¨(3.3.0 è¯¥æ–¹æ³•æœ‰bug)
    }
}
```

æˆ‘ä»¬æ¨¡ä»¿å®˜ç½‘ä¸Šçš„ä¾‹å­æ¥è¿›è¡Œæµ‹è¯•

```java
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName("createTime",new Date(),metaObject);
        this.setFieldValByName("updateTime",new Date(),metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("updateTime",new Date(),metaObject);
    }
}
```

æˆ‘ä»¬æ’å…¥ä¸€æ¡æ•°æ®

![image-20210429112243781](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429112243781.png)

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ—¶é—´æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œæ·»åŠ 

æˆ‘ä»¬å†åˆšæ‰æ’å…¥çš„æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œ

![image-20210429113422875](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429113422875.png)

**æ³¨æ„**ï¼š

![image-20210429112635032](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429112635032.png)





## ä¹è§‚é”

**ä¸»è¦é€‚ç”¨åœºæ™¯ï¼š**å½“è¦æ›´æ–°ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¸Œæœ›è¿™æ¡è®°å½•æ²¡æœ‰è¢«åˆ«äººæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°çº¿ç¨‹å®‰å…¨çš„æ•°æ®æ›´æ–°

**ä¸ºä»€ä¹ˆéœ€è¦ä¹è§‚é”**

å¤šä¸ªäººåŒæ—¶æ›´æ–°ä¸€æ¡è®°å½•ï¼Œä¸€å¼€å§‹æ‹¿åˆ°çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œå®æ—¶çš„æ›´æ–°ï¼Œå› ä¸ºä¸Šä¸€ä¸ªäººå·²ç»æŠŠæ•°æ®ä¿®æ”¹äº†ï¼Œè€Œå¦å¤–çš„äººæ‹¿çš„æ˜¯æ²¡æœ‰æ›´æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™å°±ä¼šæœ‰å¯èƒ½é€ æˆæ›´æ–°ä¸¢å¤±ï¼Œå°±æ˜¯ä¸¢å¤±ä¸Šä¸€ä¸ªäººæ›´æ–°çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ä¹è§‚é”æ¥é˜²æ­¢æ›´æ–°ä¸¢å¤±



**å®ç°åŸç†**

æ·»åŠ ä¸€ä¸ªversionå­—æ®µï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ¯ä¸€æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦åˆ°æ•°æ®åº“ä¸­æ¯”å¯¹ä¸€ä¸‹ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬ä¸å¯¹ï¼Œé‚£ä¹ˆæ›´æ–°å¤±è´¥ï¼Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§



**ä»£ç å®ç°**

1	æ·»åŠ ä¸€ä¸ªversionå­—æ®µ 

![image-20210429114506553](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429114506553.png)

2	é…ç½®æ’ä»¶

å®˜ç½‘çš„ç¤ºä¾‹

```java
// Spring Boot æ–¹å¼
@Configuration
@MapperScan("æŒ‰éœ€ä¿®æ”¹")
public class MybatisPlusConfig {
    /**
     * æ—§ç‰ˆ
     */
    @Bean
    public OptimisticLockerInterceptor optimisticLockerInterceptor() {
        return new OptimisticLockerInterceptor();
    }
    
    /**
     * æ–°ç‰ˆ
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();
        mybatisPlusInterceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        return mybatisPlusInterceptor;
    }
}
```

æˆ‘ä»¬æŒ‰ç…§å®˜ç½‘çš„æ¥

```java
@Configuration
@MapperScan("com.xiaozhi.mybatisplus.mapper")
public class MpConfig {

    // ä¹è§‚é”é…ç½®
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        return interceptor;
    }
}
```

3	å®ä½“ç±»æ·»åŠ @Versionæ³¨è§£

```java
    @Version
    private Integer version;
```

è¿™æ ·å°±å®Œæˆäº†æˆ‘ä»¬çš„ä¹è§‚é”çš„é…ç½®äº†





## æŸ¥è¯¢

### é€šè¿‡å¤šä¸ªIDæ‰¹é‡æŸ¥è¯¢

```java
@Test
public void batchTest(){
    // æ‰¹é‡æŸ¥è¯¢
    List<User> users = userMapper.selectBatchIds(Arrays.asList(1, 2, 3));
    for (User user : users) {
        System.out.println(user);
    }
}
```



### ç®€å•çš„æ¡ä»¶æŸ¥è¯¢

```java
@Test
public void conditionSelectTest(){
    // ç®€å•çš„æ¡ä»¶æŸ¥è¯¢
    HashMap<String , Object> map = new HashMap<>();
    // åå­—æ˜¯Tomå¹¶ä¸”å¹´é¾„æ˜¯28
    map.put("name","Tom");
    map.put("age","28");
    List<User> users = userMapper.selectByMap(map);
    System.out.println(users);
}
```



### åˆ†é¡µæŸ¥è¯¢

**æµ‹è¯•selectPageåˆ†é¡µ**

1	é…ç½®åˆ†é¡µæ’ä»¶

æŒ‰ç…§å®˜ç½‘çš„æ¥

```java
// æœ€æ–°ç‰ˆ
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.H2));
        return interceptor;
    }
```

2	æµ‹è¯•

```java
// æµ‹è¯•åˆ†é¡µæŸ¥è¯¢
@Test
public void pageSelectTest(){
    Page<User> page = new Page<>(1, 3);     // å½“å‰é¡µå’Œæ¯é¡µæ˜¾ç¤ºæ¡æ•°
    Page<User> selectPage = userMapper.selectPage(page, null);
    List<User> records = selectPage.getRecords();   // æŸ¥è¯¢åˆ°çš„æ•°æ®
    long current = selectPage.getCurrent();         // å½“å‰é¡µ
    long size = selectPage.getSize();               // é¡µè®°å½•æ•°
    long total = selectPage.getTotal();             // æ€»è®°å½•æ•°
    boolean hasNext = selectPage.hasNext();         // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
    boolean hasPrevious = selectPage.hasPrevious(); // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ

    System.out.println(records);
    System.out.println(current);
    System.out.println(size);
    System.out.println(total);
    System.out.println(hasNext);
    System.out.println(hasPrevious);
}
```

3	æŸ¥çœ‹ç»“æœ

![image-20210429161029809](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429161029809.png)



**æµ‹è¯•selectMapsPageåˆ†é¡µ**

å½“æŒ‡å®šäº†ç‰¹å®šçš„æŸ¥è¯¢åˆ—æ—¶ï¼Œå¸Œæœ›åˆ†é¡µç»“æœåˆ—è¡¨åªè¿”å›è¢«æŸ¥è¯¢çš„åˆ—ï¼Œè€Œä¸æ˜¯å¾ˆå¤šnullå€¼

æµ‹è¯•selectMapsPageåˆ†é¡µï¼šç»“æœé›†æ˜¯Map

```java
// æµ‹è¯•ç‰¹å®šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢
@Test
public void selectMapsPageTest(){
    Page<Map<String,Object>> page = new Page<>(1, 3);
    Page<Map<String, Object>> mapPage = userMapper.selectMapsPage(page, null);
    mapPage.getRecords().forEach(System.out::println);
}
```

![image-20210429162308496](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429162308496.png)





## åˆ é™¤ä¸é€»è¾‘åˆ é™¤

### åˆ é™¤

1	æ ¹æ®idåˆ é™¤

```java
// æ ¹æ®idåˆ é™¤
@Test
public void deleteByIdTest(){
    int i = userMapper.deleteById(1);
    System.out.println(i);
}
```

2	æ‰¹é‡åˆ é™¤

```java
// æ‰¹é‡åˆ é™¤
@Test
public void deleteBatchTest(){
    int i = userMapper.deleteBatchIds(Arrays.asList(2,3,4));
    System.out.println(i);
}
```

3	ç®€å•æ¡ä»¶åˆ é™¤

```java
// ç®€å•æ¡ä»¶åˆ é™¤
@Test
public void deleteConditionTest(){
    HashMap<String, Object> map = new HashMap<>();
    map.put("name","Billie");      // åˆ é™¤åå­—ä¸ºBillieçš„è®°å½•
    int i = userMapper.deleteByMap(map);
    System.out.println(i);
}
```



### é€»è¾‘åˆ é™¤

ç‰©ç†åˆ é™¤ï¼šæ•°æ®åº“ä¸Šç›´æ¥åˆ é™¤

é€»è¾‘åˆ é™¤ï¼šç»è¿‡åˆ é™¤çš„æ•°æ®æ˜¯æŸ¥è¯¢ä¸åˆ°çš„ï¼Œä½†æ˜¯æ•°æ®åº“ä¸Šä¾ç„¶å­˜åœ¨

å®ç°åŸç†ï¼šåŠ ä¸Šä¸€ä¸ªå­—æ®µï¼Œæ²¡æœ‰é€»è¾‘åˆ é™¤çš„ä¸º1ï¼Œåˆ é™¤çš„ä¸º0ï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™å°±ä¼šåŠ ä¸Šä¸€ä¸ªæ¡ä»¶æŸ¥è¯¢ï¼Œé€šè¿‡è¿™ä¸ªæ¥å®Œæˆæˆ‘ä»¬çš„é€»è¾‘åˆ é™¤



**ä»£ç å®ç°**

1	æ·»åŠ deletedå­—æ®µ

```sql
ALTER TABLE `user` ADD `deleted` BOOLEAN DEFAULT FALSE
```

2	å®ä½“ç±»æ·»åŠ å­—æ®µ

æ·»åŠ deleted å­—æ®µï¼Œå¹¶åŠ ä¸Š @TableLogic æ³¨è§£ 

```java
@TableField
private Integer deleted;
```

3	é…ç½®com.baomidou.mybatisplus.core.config.GlobalConfig$DbConfig

```properties
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: flag  # å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(since 3.3.0,é…ç½®åå¯ä»¥ä¸ç”¨åŠ @TableLogicæ³¨è§£)
      logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
      logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
```

4	æµ‹è¯•

```java
// æµ‹è¯•é€»è¾‘åˆ é™¤
@Test
public void deletedTest(){
    int i = userMapper.deleteById(7);
    System.out.println(userMapper.selectById(6));
}
```

![image-20210429170345905](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429170345905.png)



åŸç†ä¸Šå°±æ˜¯åŠ äº†ä¸€ä¸ªæ¡ä»¶æŸ¥è¯¢

![image-20210429170314310](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429170314310.png)





## æ¡ä»¶æ„é€ å™¨å’Œå¸¸ç”¨æ¥å£

### Wapperæ¥å£

![image-20210429170453028](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429170453028.png)

Wrapper ï¼š æ¡ä»¶æ„é€ æŠ½è±¡ç±»ï¼Œæœ€é¡¶ç«¯çˆ¶ç±»  

  AbstractWrapper ï¼š ç”¨äºæŸ¥è¯¢æ¡ä»¶å°è£…ï¼Œç”Ÿæˆ sql çš„ where æ¡ä»¶

â€‹    	QueryWrapper ï¼š æŸ¥è¯¢æ¡ä»¶å°è£…

â€‹    	UpdateWrapper ï¼š Update æ¡ä»¶å°è£…

  AbstractLambdaWrapper ï¼š ä½¿ç”¨Lambda è¯­æ³•

  	  LambdaQueryWrapper ï¼šç”¨äºLambdaè¯­æ³•ä½¿ç”¨çš„æŸ¥è¯¢Wrapper

â€‹		LambdaUpdateWrapper ï¼š Lambda æ›´æ–°å°è£…Wrapper



### å¸¸ç”¨æ¥å£

å®˜ç½‘ä¸Šéƒ½æœ‰è§£é‡Šï¼Œå¯ä»¥æŸ¥é˜…å®˜ç½‘æ¥è¿›è¡Œä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨ä¸€äº›å¸¸ç”¨çš„æ¥å£



#### æ¡ä»¶æŸ¥è¯¢

```java
@Test
public void WrapperTest(){
    QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
    // æŸ¥è¯¢å¹´é¾„æ˜¯20ï¼Œåå­—æ˜¯å­™æ‚Ÿç©ºçš„å­—æ®µ
    userQueryWrapper.eq("age",20)
            .eq("name","å­™æ‚Ÿç©º");
    List<User> users = userMapper.selectList(userQueryWrapper);
    users.forEach(System.out::println);
}
```



#### æ¨¡ç³ŠæŸ¥è¯¢

like		ä¸¤è¾¹éƒ½æœ‰%

```java
// æ¨¡ç³ŠæŸ¥è¯¢
    @Test
    public void mohuTest(){
        QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
        // æŸ¥è¯¢åå­—ä¸­æœ‰æ™ºçš„
        userQueryWrapper.like("name","æ™º");
        List<User> users = userMapper.selectList(userQueryWrapper);
        users.forEach(System.out::println);
    }
```

likeLeft	likeRight		

```java
// æ¨¡ç³Šå·¦æŸ¥è¯¢
@Test
public void leftTest(){
    QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
    // æŸ¥è¯¢å§“å­™çš„
    userQueryWrapper.likeRight("name","å­™");
    List<User> users = userMapper.selectList(userQueryWrapper);
    users.forEach(System.out::println);
}
```

![image-20210429172259569](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429172259569.png)

å·¦å³å°±æ˜¯%çš„ä½ç½®



#### åˆ†ç»„æŸ¥è¯¢

orderByã€orderByDescã€orderByAsc

```java
// åˆ†ç»„æŸ¥è¯¢
@Test
public void orderByTest(){
    QueryWrapper<User> wrapper = new QueryWrapper<>();
    // å‰åçš„ä½ç½®å°±æ˜¯å…ˆæ¯”è¾ƒé‚£ä¸ªï¼Œå¦‚æœç›¸åŒï¼Œé‚£ä¹ˆå†æ¯”è¾ƒé‚£ä¸ª
    wrapper.orderByDesc("id","age");
    List<User> users = userMapper.selectList(wrapper);
    users.forEach(System.out::println);
}
```

![image-20210429173034089](F:\Javaå­¦ä¹ \æˆªå›¾\image-20210429173034089.png)





### æŸ¥è¯¢æ–¹å¼

| **æŸ¥è¯¢æ–¹å¼**     | **è¯´æ˜**                          |
| ---------------- | --------------------------------- |
| **setSqlSelect** | è®¾ç½® SELECT æŸ¥è¯¢å­—æ®µ              |
| **where**        | WHERE  è¯­å¥ï¼Œæ‹¼æ¥  + WHERE æ¡ä»¶   |
| **and**          | AND  è¯­å¥ï¼Œæ‹¼æ¥  + AND å­—æ®µ=å€¼    |
| **andNew**       | AND  è¯­å¥ï¼Œæ‹¼æ¥  + AND (å­—æ®µ=å€¼)  |
| **or**           | OR  è¯­å¥ï¼Œæ‹¼æ¥  + OR å­—æ®µ=å€¼      |
| **orNew**        | OR  è¯­å¥ï¼Œæ‹¼æ¥  + OR (å­—æ®µ=å€¼)    |
| **eq**           | ç­‰äº=                             |
| **allEq**        | åŸºäº map å†…å®¹ç­‰äº=                |
| **ne**           | ä¸ç­‰äº<>                          |
| **gt**           | å¤§äº>                             |
| **ge**           | å¤§äºç­‰äº>=                        |
| **lt**           | å°äº<                             |
| **le**           | å°äºç­‰äº<=                        |
| **like**         | æ¨¡ç³ŠæŸ¥è¯¢ LIKE                     |
| **notLike**      | æ¨¡ç³ŠæŸ¥è¯¢ NOT LIKE                 |
| **in**           | IN  æŸ¥è¯¢                          |
| **notIn**        | NOT  IN æŸ¥è¯¢                      |
| **isNull**       | NULL  å€¼æŸ¥è¯¢                      |
| **isNotNull**    | IS  NOT NULL                      |
| **groupBy**      | åˆ†ç»„ GROUP BY                     |
| **having**       | HAVING  å…³é”®è¯                    |
| **orderBy**      | æ’åº ORDER BY                     |
| **orderAsc**     | ASC  æ’åº ORDER  BY               |
| **orderDesc**    | DESC  æ’åº ORDER  BY              |
| **exists**       | EXISTS  æ¡ä»¶è¯­å¥                  |
| **notExists**    | NOT  EXISTS æ¡ä»¶è¯­å¥              |
| **between**      | BETWEEN  æ¡ä»¶è¯­å¥                 |
| **notBetween**   | NOT  BETWEEN æ¡ä»¶è¯­å¥             |
| **addFilter**    | è‡ªç”±æ‹¼æ¥ SQL                      |
| **last**         | æ‹¼æ¥åœ¨æœ€åï¼Œä¾‹å¦‚ï¼šlast(â€œLIMIT 1â€) |



# ä½¿ç”¨CRUDæ¥å£

serviceç»§æ‰¿Iserviceæ¥å£

serviceImplç»§æ‰¿ServiceImplç±»ï¼Œå†å®ç°serviceç±»



